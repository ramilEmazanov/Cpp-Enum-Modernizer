# Документация проекта C++ Enum Modernizer

## Оглавление

1. [Возможности](#возможности)
2. [Установка](#установка)
3. [Использование](#использование)
4. [Архитектура](#архитектура)
5. [API документация](#api-документация)
6. [Примеры использования](#примеры-использования)

---

## Возможности

### Основные функции

1. **Автоматическое преобразование `enum` → `enum class`**
   - Обнаруживает все перечисления в коде
   - Преобразует их в типобезопасный формат `enum class`
   - Сохраняет существующие `enum class` без изменений

2. **Переименование констант в стиль `kPascalCase`**
   - `RED_VALUE` → `kRedValue`
   - `blue` → `kBlue`
   - `someValue` → `kSomeValue`
   - `kAlreadyGood` → остаётся без изменений

3. **Работа с выделенным текстом или всем файлом**
   - Если выделен текст — обрабатывается только выделение
   - Если выделения нет — обрабатывается весь документ

4. **Сохранение структуры кода**
   - Сохраняет инициализаторы значений (`= 0`, `= 1`, и т.д.)
   - Сохраняет комментарии после элементов перечисления
   - Сохраняет форматирование

### Пример преобразования

**До:**
```cpp
enum Color {
    red,
    Blue,
    GREEN_COLOR,
    kAlreadyGood
};
```

**После:**
```cpp
enum class Color {
    kRed,
    kBlue,
    kGreenColor,
    kAlreadyGood
};
```

---

## Установка

### Вариант 1: Установка из VSIX файла

1. Соберите расширение (если у вас есть исходный код):
   ```bash
   npm install -g @vscode/vsce
   vsce package
   ```
   Это создаст файл `cpp-enum-classify-0.0.1.vsix`

2. Установите в VS Code:
   - Откройте VS Code
   - Перейдите в раздел Extensions (Ctrl+Shift+X)
   - Нажмите на `...` (три точки) в правом верхнем углу
   - Выберите **Install from VSIX...**
   - Выберите файл `.vsix`

### Вариант 2: Запуск в режиме разработки

1. Откройте проект в VS Code
2. Нажмите **F5** или выберите **Run > Start Debugging**
3. Откроется новое окно "Extension Development Host"
4. В новом окне откройте C++ файл и используйте расширение

---

## Использование

### Команда

Расширение добавляет команду: **"C++: Convert enum → enum class & rename to kStyle"**

### Способы вызова

1. **Через Command Palette:**
   - Нажмите `Ctrl+Shift+P` (или `Cmd+Shift+P` на macOS)
   - Введите "C++: Convert enum"
   - Выберите команду

2. **Через горячую клавишу:**
   - Нажмите `Ctrl+Shift+K` (работает только в C++ файлах)

3. **Через контекстное меню:**
   - Правый клик в редакторе → команда в списке

### Режимы работы

- **Обработка всего файла:** Убедитесь, что ничего не выделено, и выполните команду
- **Обработка выделения:** Выделите нужный фрагмент кода и выполните команду

---

## Архитектура

### Общая схема работы

```
┌──────────────────────────────────────────┐
│         Активация команды                │
│    (Ctrl+Shift+K или Command Palette)    │
└──────────────────────────────────────────┘
                    │
                    ▼
        ┌─────────────────────────┐
        │  Получение текста       │
        │  (выделение или файл)   │
        └─────────────────────────┘
                    │
                    ▼
     ┌────────────────────────────────┐
     │  processText()                 │
     │  - Поиск всех enum блоков      │
     │  - Регулярное выражение        │
     └────────────────────────────────┘
                    │
                    ▼
     ┌────────────────────────────────┐
     │  transformEnumBlock()          │
     │  (для каждого найденного enum) │
     │  - Проверка enum class         │
     │  - Обработка тела              │
     └────────────────────────────────┘
                    │
                    ▼
     ┌────────────────────────────────┐
     │  transformEnumBody()           │
     │  - Разбор элементов            │
     │  - Сохранение инициализаторов  │
     └────────────────────────────────┘
                    │
                    ▼
     ┌────────────────────────────────┐
     │  toKStyle()                    │
     │  (для каждого имени)           │
     │  - Преобразование в kPascalCase│
     └────────────────────────────────┘
                    │
                    ▼
       ┌────────────────────────────┐
       │  Замена текста в редакторе │
       └────────────────────────────┘
```

### Поток данных

1. **Входные данные:** Исходный C++ код с `enum` перечислениями
2. **Обработка:** Поиск и преобразование через цепочку функций
3. **Выходные данные:** Модернизированный код с `enum class` и `kPascalCase` именами

### Ключевые компоненты

- **Регулярные выражения:** Для поиска и парсинга `enum` блоков
- **Функции преобразования:** Модульная структура для каждого этапа
- **VS Code API:** Для интеграции с редактором

---

## API документация

### `toKStyle(name: string): string`

Преобразует имя константы перечисления в стиль `kPascalCase`.

**Параметры:**
- `name` (string) — исходное имя константы

**Возвращает:**
- `string` — имя в формате `kPascalCase`

**Логика работы:**

1. Если строка пустая → возвращает как есть
2. Если имя уже начинается с `k` (проверка `/^\s*k/`) → возвращает без изменений
3. Разбиение имени:
   - Вставляет пробел между camelCase стыками: `([a-z0-9])([A-Z]) → $1 $2`
   - Заменяет разделители `_`, `-`, `.`, пробелы на единичный пробел
4. Каждую часть приводит к `PascalCase` (первая буква заглавная, остальные строчные)
5. Соединяет части и добавляет префикс `k`

**Примеры:**
```javascript
toKStyle("RED_VALUE")    // → "kRedValue"
toKStyle("blue")         // → "kBlue"
toKStyle("someValue")    // → "kSomeValue"
toKStyle("kAlreadyGood") // → "kAlreadyGood"
toKStyle("my_enum_val")  // → "kMyEnumVal"
```

---

### `transformEnumBody(body: string, enumName: string): string`

Преобразует содержимое тела перечисления `{ ... }`.

**Параметры:**
- `body` (string) — содержимое между фигурными скобками
- `enumName` (string) — имя перечисления (используется для контекста, в текущей реализации не используется)

**Возвращает:**
- `string` — преобразованное тело с отступами

**Алгоритм:**

1. Разделяет элементы перечисления по запятой `,`
2. Для каждого элемента:
   - Удаляет лишние пробелы (trim)
   - Парсит через регулярное выражение: `^([A-Za-z_]\w*)(\s*=\s*[^\/,]+)?(.*)$`
     - Группа 1: имя константы
     - Группа 2: инициализатор `= ...` (опционально)
     - Группа 3: оставшаяся часть (комментарии и т.д.)
3. Преобразует имя через `toKStyle()`, если оно не начинается с `k`
4. Собирает элементы обратно с сохранением инициализаторов и комментариев
5. Форматирует результат с отступами

**Пример:**
```javascript
transformEnumBody("red, Blue = 1, GREEN_COLOR", "Color")
// → "{\n    kRed,\n    kBlue = 1,\n    kGreenColor\n}"
```

---

### `transformEnumBlock(fullMatch, enumKw, afterEnum, enumName, body): string`

Преобразует полный блок `enum ... { ... }`.

**Параметры:**
- `fullMatch` (string) — полное совпадение регулярного выражения
- `enumKw` (string) — ключевое слово `enum`
- `afterEnum` (string) — текст после `enum` (может содержать `class` или `struct`)
- `enumName` (string) — имя перечисления
- `body` (string) — содержимое тела `{ ... }`

**Возвращает:**
- `string` — преобразованный блок кода

**Логика:**

1. Проверяет, является ли перечисление уже `enum class` или `enum struct`:
   - Поиск `\bclass\b` в `afterEnum`
2. Обрабатывает тело через `transformEnumBody()`
3. Если `enum` не содержит `class`:
   - Заменяет `enum` → `enum class`
4. Заменяет старое тело `{ ... }` на новое

**Пример:**
```javascript
// Вход: "enum Color { red, blue }"
// Выход: "enum class Color { kRed, kBlue }"
```

---

### `processText(text: string): string`

Обрабатывает весь текст документа или выделения.

**Параметры:**
- `text` (string) — исходный текст для обработки

**Возвращает:**
- `string` — преобразованный текст

**Используемое регулярное выражение:**
```javascript
/\b(enum)\b(\s+(?:class|struct))?\s+(\w+)?\s*\{([\s\S]*?)\}/g
```

**Группы захвата:**
1. `enum` — ключевое слово
2. `class` или `struct` (опционально)
3. Имя перечисления (опционально для анонимных enum)
4. Тело `{...}`

**Работа:**
- Находит все совпадения в тексте
- Для каждого совпадения вызывает `transformEnumBlock()`
- Возвращает полностью преобразованный текст

---

### `activate(context: vscode.ExtensionContext): void`

Точка входа расширения VS Code.

**Параметры:**
- `context` (vscode.ExtensionContext) — контекст расширения

**Действия:**

1. Регистрирует команду `extension.enumsToEnumClassKStyle`
2. При выполнении команды:
   - Получает активный редактор
   - Определяет, есть ли выделение
   - Получает текст (выделение или весь документ)
   - Применяет `processText()`
   - Если текст изменился, заменяет его через `editor.edit()`
3. Добавляет команду в подписки для правильной очистки при деактивации

---

### `deactivate(): void`

Функция деактивации расширения. В текущей реализации пустая, но может использоваться для очистки ресурсов.

---

## Примеры использования

### Пример 1: Простое перечисление

**До:**
```cpp
enum Status {
    pending,
    processing,
    completed,
    failed
};
```

**После:**
```cpp
enum class Status {
    kPending,
    kProcessing,
    kCompleted,
    kFailed
};
```

---

### Пример 2: Перечисление с инициализаторами

**До:**
```cpp
enum ErrorCode {
    NO_ERROR = 0,
    FILE_NOT_FOUND = 1,
    PERMISSION_DENIED = 2
};
```

**После:**
```cpp
enum class ErrorCode {
    kNoError = 0,
    kFileNotFound = 1,
    kPermissionDenied = 2
};
```

---

### Пример 3: Смешанные стили имён

**До:**
```cpp
enum Colors {
    red,
    BLUE,
    greenColor,
    kAlreadyGood,
    yellow_value
};
```

**После:**
```cpp
enum class Colors {
    kRed,
    kBlue,
    kGreenColor,
    kAlreadyGood,
    kYellowValue
};
```

---

### Пример 4: Уже существующий enum class

**До:**
```cpp
enum class Direction {
    north,
    SOUTH,
    east_west
};
```

**После:**
```cpp
enum class Direction {
    kNorth,
    kSouth,
    kEastWest
};
```

---

### Пример 5: Перечисление с комментариями

**До:**
```cpp
enum State {
    idle,      // начальное состояние
    running,   // выполняется
    stopped    // остановлено
};
```

**После:**
```cpp
enum class State {
    kIdle,      // начальное состояние
    kRunning,   // выполняется
    kStopped    // остановлено
};
```

---

## Разработка

### Структура проекта

```
cpp-enum-modernizer/
│
├── extension.js          # основной код расширения
├── package.json          # манифест расширения
├── README.md             # описание проекта
├── documentation.md      # данная документация
├── LICENSE               # лицензия
├── package-lock.json     # зависимости npm
└── cpp-enum-classify-0.0.1.vsix  # собранный пакет
```

### Зависимости

- **VS Code API:** Встроенный модуль `vscode` (версия ^1.85.0)
- **@vscode/vsce:** Инструмент для упаковки расширения (dev dependency)

### Сборка проекта

1. Установите зависимости:
   ```bash
   npm install
   ```

2. Соберите VSIX пакет:
   ```bash
   npx @vscode/vsce package
   ```

3. Результат: файл `cpp-enum-classify-0.0.1.vsix`

### Тестирование

1. Откройте проект в VS Code
2. Нажмите **F5** для запуска в режиме разработки
3. В новом окне создайте тестовый C++ файл:
   ```cpp
   enum Test {
       value1,
       VALUE_TWO,
       kGood
   };
   ```
4. Выполните команду `Ctrl+Shift+K`
5. Проверьте результат

---

## Лицензия

См. файл `LICENSE` в корне проекта.


